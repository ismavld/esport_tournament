<%- include('../partials/header', { page: 'teams', title: 'Ã‰quipes - E-Sport Tournaments' }) %>

      <div class="page-header">
        <h1>ðŸ‘¥ Ã‰quipes</h1>
        <p>Gestion et dÃ©couverte des Ã©quipes e-sport</p>
      </div>

      <div class="card">
        <div class="card-title">ðŸ“‹ Liste des Ã‰quipes</div>
        <p>Les Ã©quipes seront chargÃ©es depuis l'API.</p>
        <div id="teams-list" style="margin-top: 20px;">
          <p style="color: #888;">Chargement des Ã©quipes...</p>
        </div>
      </div>

      <div class="card">
        <div class="card-title">âž• CrÃ©er une Ã‰quipe</div>
        <div id="team-create">
          <p style="margin-bottom: 20px;">CrÃ©ez votre propre Ã©quipe et invitez des joueurs Ã  la rejoindre.</p>
          <a href="/connexion" class="btn btn-primary">Se Connecter pour CrÃ©er</a>
        </div>
        <div id="team-create-form" style="display: none;">
          <form id="create-team-form">
            <div class="form-group">
              <label for="team-name">Nom de l'Ã‰quipe:</label>
              <input type="text" id="team-name" name="name" required />
            </div>
            <div class="form-group">
              <label for="team-tag">Tag (Sigle):</label>
              <input type="text" id="team-tag" name="tag" placeholder="ex: FNATIC" required />
            </div>
            <button type="submit" class="btn btn-primary">CrÃ©er l'Ã‰quipe</button>
          </form>
        </div>
      </div>

      <script>
        async function loadTeams() {
          try {
            const response = await fetch('/api/teams');
            let data = await response.json();
            
            const container = document.getElementById('teams-list');
            
            // Handle both array and object responses
            if (data && typeof data === 'object') {
              if (!Array.isArray(data)) {
                data = data.data || [];
              }
            }
            
            if (Array.isArray(data)) {
              if (data.length === 0) {
                container.innerHTML = '<p style="color: #888;">Aucune Ã©quipe disponible pour le moment.</p>';
              } else {
                container.innerHTML = data.map(t => `
                  <div class="team-item" style="border: 1px solid #e5e7eb; padding: 12px; margin-bottom: 8px; border-radius: 6px;">
                    <strong>${t.name}</strong> <span style="background: #dbeafe; padding: 2px 8px; border-radius: 4px; font-size: 0.85em;">${t.tag}</span>
                  </div>
                `).join('');
              }
            } else {
              container.innerHTML = '<p style="color: #f87171;">Aucune Ã©quipe disponible pour le moment.</p>';
            }
          } catch (error) {
            console.error('Error:', error);
            document.getElementById('teams-list').innerHTML = '<p style="color: #f87171;">Erreur de connexion Ã  l\'API.</p>';
          }
        }

        function updateTeamUI() {
          const token = localStorage.getItem('token');
          
          const createSection = document.getElementById('team-create');
          const createForm = document.getElementById('team-create-form');
          
          if (token) {
            createSection.style.display = 'none';
            createForm.style.display = 'block';
          }
        }

        loadTeams();
        updateTeamUI();
        window.addEventListener('storage', () => {
          loadTeams();
          updateTeamUI();
        });
      </script>

<%- include('../partials/footer') %>
