<%- include('../partials/header', { page: 'auth', title: 'Connexion - E-Sport Tournaments' }) %>

      <div class="page-header">
        <h1>üîê Connexion</h1>
        <p>Connectez-vous ou cr√©ez un compte pour acc√©der √† votre espace</p>
      </div>

      <div class="form-container">
        <div class="card">
          <div class="card-title">üìù Connexion</div>
          <form id="login-form">
            <div class="form-group">
              <label for="login-email">Email:</label>
              <input type="email" id="login-email" name="email" required />
            </div>
            <div class="form-group">
              <label for="login-password">Mot de passe:</label>
              <input type="password" id="login-password" name="password" required />
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 10px;">Se Connecter</button>
          </form>
          <p style="text-align: center; margin-top: 16px;">
            <a href="#" onclick="toggleForms(); return false;" style="color: #6366f1; text-decoration: underline;">Pas encore de compte?</a>
          </p>
        </div>

        <div class="card">
          <div class="card-title">‚úçÔ∏è Inscription</div>
          <form id="register-form" style="display: none;">
            <div class="form-group">
              <label for="register-email">Email:</label>
              <input type="email" id="register-email" name="email" required />
            </div>
            <div class="form-group">
              <label for="register-username">Nom d'utilisateur:</label>
              <input type="text" id="register-username" name="username" placeholder="3-20 caract√®res" required />
            </div>
            <div class="form-group">
              <label for="register-password">Mot de passe:</label>
              <input type="password" id="register-password" name="password" 
                     placeholder="Min 8 car, 1 majuscule, 1 minuscule, 1 chiffre" required />
            </div>
            <div class="form-group">
              <label for="register-role">R√¥le:</label>
              <select id="register-role" name="role">
                <option value="PLAYER">Joueur</option>
                <option value="ORGANIZER">Organisateur</option>
              </select>
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 10px;">S'inscrire</button>
            <p style="text-align: center; margin-top: 12px; font-size: 0.9em;">
              <a href="#" onclick="toggleForms(); return false;" style="color: #6366f1; text-decoration: underline;">D√©j√† inscrit?</a>
            </p>
          </form>
        </div>

        <div id="message" style="margin-top: 16px; padding: 12px; border-radius: 6px; display: none;"></div>
      </div>

      <style>
        .form-container {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 20px;
          max-width: 800px;
          margin: 0 auto;
        }
        .form-group {
          margin-bottom: 16px;
        }
        .form-group label {
          display: block;
          margin-bottom: 6px;
          font-weight: 500;
          color: #1f2937;
        }
        .form-group input,
        .form-group select {
          width: 100%;
          padding: 8px 12px;
          border: 1px solid #e5e7eb;
          border-radius: 4px;
          font-size: 1em;
        }
        .form-group input:focus,
        .form-group select:focus {
          outline: none;
          border-color: #6366f1;
          box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        @media (max-width: 768px) {
          .form-container {
            grid-template-columns: 1fr;
          }
        }
      </style>

      <script>
        function toggleForms() {
          const loginForm = document.getElementById('login-form');
          const registerForm = document.getElementById('register-form');
          loginForm.style.display = loginForm.style.display === 'none' ? 'block' : 'none';
          registerForm.style.display = registerForm.style.display === 'none' ? 'block' : 'none';
        }

        // Handle Login
        document.getElementById('login-form').addEventListener('submit', async (e) => {
          e.preventDefault();
          const message = document.getElementById('message');
          
          try {
            const response = await fetch('/api/auth/login', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                email: document.getElementById('login-email').value,
                password: document.getElementById('login-password').value
              })
            });

            const data = await response.json();

            if (response.ok) {
              // Store user and token in localStorage
              localStorage.setItem('user', JSON.stringify(data.user));
              localStorage.setItem('token', data.token);
              
              message.style.backgroundColor = '#dcfce7';
              message.style.color = '#166534';
              message.textContent = '‚úÖ Connexion r√©ussie! Redirection...';
              message.style.display = 'block';
              
              setTimeout(() => {
                window.location.href = '/profil';
              }, 1500);
            } else {
              message.style.backgroundColor = '#fee2e2';
              message.style.color = '#991b1b';
              message.textContent = '‚ùå ' + (data.error?.message || 'Erreur lors de la connexion');
              message.style.display = 'block';
            }
          } catch (error) {
            message.style.backgroundColor = '#fee2e2';
            message.style.color = '#991b1b';
            message.textContent = '‚ùå Erreur de connexion';
            message.style.display = 'block';
          }
        });

        // Handle Registration
        document.getElementById('register-form').addEventListener('submit', async (e) => {
          e.preventDefault();
          const message = document.getElementById('message');
          
          try {
            const response = await fetch('/api/auth/register', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                email: document.getElementById('register-email').value,
                username: document.getElementById('register-username').value,
                password: document.getElementById('register-password').value,
                role: document.getElementById('register-role').value
              })
            });

            const data = await response.json();

            if (response.ok) {
              message.style.backgroundColor = '#dcfce7';
              message.style.color = '#166534';
              message.textContent = '‚úÖ Inscription r√©ussie! Vous pouvez maintenant vous connecter.';
              document.getElementById('register-form').reset();
              setTimeout(() => toggleForms(), 2000);
            } else {
              message.style.backgroundColor = '#fee2e2';
              message.style.color = '#991b1b';
              message.textContent = '‚ùå ' + (data.error?.message || 'Erreur lors de l\'inscription');
            }
            message.style.display = 'block';
          } catch (error) {
            message.style.backgroundColor = '#fee2e2';
            message.style.color = '#991b1b';
            message.textContent = '‚ùå Erreur de connexion';
            message.style.display = 'block';
          }
        });
      </script>

<%- include('../partials/footer') %>
